name: Gist Token Backup

on:
  workflow_dispatch:

jobs:
  check-gist:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Check GIST_TOKEN
        run: |
          echo "ğŸ” GIST_TOKENï¼ˆå…ˆé ­8æ–‡å­—ã ã‘ï¼‰: ${GIST_TOKEN::8}"
        env:
          GIST_TOKEN: ${{ secrets.GIST_TOKEN }}

      - name: Fetch replied.json from Gist
        run: |
          echo "ğŸŒ Gist ã‹ã‚‰ replied.json ã‚’å–å¾—ä¸­..."
          GIST_ID="40391085a2e0b8a48935ad0b460cf422"
          FILENAME="replied.json"
          GIST_USER="mofu-mitsu"
          GIST_URL="https://gist.githubusercontent.com/${GIST_USER}/${GIST_ID}/raw/${FILENAME}"

          echo "ğŸ“¥ å–å¾—URL: $GIST_URL"
          HTTP_STATUS=$(curl -s -o temp.json -w "%{http_code}" "$GIST_URL")
          
          if [ "$HTTP_STATUS" = "200" ]; then
            echo "âœ… replied.json ã‚’æ­£å¸¸ã«å–å¾—ã—ã¾ã—ãŸï¼"
            echo "ğŸ“ ä¸Šä½3ä»¶ã‚’è¡¨ç¤º:"
            head -n 10 temp.json | jq . | head -n 15
          else
            echo "âŒ å–å¾—å¤±æ•—ï¼ˆHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: $HTTP_STATUSï¼‰"
            cat temp.json
            exit 1
          fi
        env:
          GIST_TOKEN: ${{ secrets.GIST_TOKEN }}