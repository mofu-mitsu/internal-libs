name: æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒ†ã‚¹ãƒˆï¼ˆæ¨ã—æ´»ã‚°ãƒƒã‚ºï¼‰

on:
  workflow_dispatch:  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ˆ

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: Pythonã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: æ¥½å¤©APIãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
        run: |
          python3 <<EOF
          import requests

          APP_ID = "1055088369869282145"
          AFFILIATE_ID = "3d94ea21.0d257908.3d94ea22.0ed11c6e"
          API_URL = "https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706"

          params = {
              "applicationId": APP_ID,
              "keyword": "æ¨ã—æ´»ã‚°ãƒƒã‚º",
              "hits": 10,
              "format": "json"
          }

          response = requests.get(API_URL, params=params)
          data = response.json()

          if data["Items"]:
              item = data["Items"][0]["Item"]
              product_url = item["itemUrl"].split("?")[0]
              affiliate_link = f"https://hb.afl.rakuten.co.jp/hgc/{AFFILIATE_ID}/?pc={product_url}"
              reply = f"ğŸ§¸ æ¨ã—æ´»ã‚¬ãƒå‹¢ã®å‘³æ–¹ã£ï¼â†’ {affiliate_link}"
              print(f"ğŸ›ï¸ å•†å“å: {item['itemName']}")
              print(f"ğŸ”— ãƒªãƒ³ã‚¯: {affiliate_link}")
              print(f"{reply}")
          else:
              print("å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸâ€¦")
          EOF