name: Rakuten API Test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: ğŸ Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pip install requests

      - name: ğŸš€ æ¥½å¤©APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        run: |
          python3 <<EOF
          import requests

          # APIè¨­å®š
          APP_ID = "1055088369869282145"
          AFFILIATE_ID = "3d94ea21.0d257908.3d94ea22.0ed11c6e"
          API_URL = "https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706"

          # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
          params = {
              "applicationId": APP_ID,
              "keyword": "æ¨ã—æ´»ã‚°ãƒƒã‚º",
              "hits": 1,
              "format": "json"
          }

          # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          response = requests.get(API_URL, params=params)
          data = response.json()

          # çµæœ
          if data["Items"]:
              item = data["Items"][0]["Item"]
              product_url = item["itemUrl"]
              affiliate_link = f"https://hb.afl.rakuten.co.jp/hgc/{AFFILIATE_ID}/?pc={product_url}"
              print(f"ğŸ›ï¸ å•†å“å: {item['itemName']}")
              print(f"ğŸ”— ãƒªãƒ³ã‚¯: {affiliate_link}")
              print(f"ğŸ§¸ æ¨ã—æ´»ã‚¬ãƒå‹¢ã®å‘³æ–¹ã£ï¼â†’ {affiliate_link}")
          else:
              print("ğŸ˜¢ å•†å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸâ€¦")
          EOF