name: Rakuten API Test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 リポジトリをチェックアウト
        uses: actions/checkout@v3

      - name: 🐍 Pythonセットアップ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 📦 必要なライブラリをインストール
        run: pip install requests

      - name: 🚀 楽天APIテスト実行
        run: |
          python3 <<EOF
          import requests

          # API設定
          APP_ID = "1055088369869282145"
          AFFILIATE_ID = "3d94ea21.0d257908.3d94ea22.0ed11c6e"
          API_URL = "https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706"

          # パラメータ
          params = {
              "applicationId": APP_ID,
              "keyword": "推し活グッズ",
              "hits": 1,
              "format": "json"
          }

          # リクエスト
          response = requests.get(API_URL, params=params)
          data = response.json()

          # 結果
          if data["Items"]:
              item = data["Items"][0]["Item"]
              product_url = item["itemUrl"]
              affiliate_link = f"https://hb.afl.rakuten.co.jp/hgc/{AFFILIATE_ID}/?pc={product_url}"
              print(f"🛍️ 商品名: {item['itemName']}")
              print(f"🔗 リンク: {affiliate_link}")
              print(f"🧸 推し活ガチ勢の味方っ！→ {affiliate_link}")
          else:
              print("😢 商品が見つかりませんでした…")
          EOF