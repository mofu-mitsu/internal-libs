name: Bluesky Repost Bot
on:
  schedule:
    - cron: '*/30 * * * *'  # 30ÂàÜ„Åî„Å®
  workflow_dispatch:  # ÊâãÂãïÂÆüË°å
concurrency:
  group: bluesky-repost-bot
  cancel-in-progress: true
jobs:
  run-repost-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - name: „É™„Éù„Ç∏„Éà„É™„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà
        uses: actions/checkout@v4
      - name: Python„Çí„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: ‰æùÂ≠òÈñ¢‰øÇ„Ç§„É≥„Çπ„Éà„Éº„É´
        run: |
          python -m pip install --upgrade pip
          pip install --no-cache-dir -r requirements.txt
      - name: „É≠„Ç∞„Çí‰øùÂ≠ò
        run: |
          mkdir -p logs
          echo "Starting üöñ „Çä„ÅΩ„Çä„ÇìBot at $(date)" >> logs/repost_bot.log
      - name: „Çä„ÅΩ„Çä„ÇìBot„ÇíÂÆüË°å
        env:
          HANDLE: ${{ secrets.HANDLE }}
          APP_PASSWORD: ${{ secrets.APP_PASSWORD }}
        run: |
          python repost_bot.py | tee -a logs/repost_bot.log
      - name: „É™„Éù„Çπ„ÉàÂ±•Ê≠¥„Çí„Ç≥„Éü„ÉÉ„Éà
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add reposted_uris.txt
          git commit -m "Update reposted_uris.txt" || echo "No changes to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: „É≠„Ç∞„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: repost-bot-logs
          path: logs/repost_bot.log